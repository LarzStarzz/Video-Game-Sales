<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Game Bar Chart Race</title>
    <style>
        /* CSS styles for the bar chart */
        #barchart-container {
            width: 800px;
            margin: 20px auto;
        }
        .bar {
            fill: steelblue;
        }
        .bar:hover {
            fill: orange;
        }
        .bar text {
            font-size: 12px;
            text-anchor: middle;
            fill: white;
        }
    </style>
</head>
<body>
    <div id="barchart-container">
        <!-- Your bar chart race will be generated here -->
    </div>

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script>
        // Load the data and create the bar chart race
        d3.csv("vgsales.csv", function(error, data) {
            if (error) {
                console.log("Error loading data:", error);
                return;
            }

            // Set up constants and variables
            const margin = { top: 20, right: 30, bottom: 30, left: 60 };
            const width = 800 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            let currentYear = 2000; // Starting year
            const duration = 1000; // Transition duration

            // Convert sales values to numbers
            data.forEach(function(d) {
                d.Global_Sales = +d.Global_Sales;
                d.Year = +d.Year;
            });

            // Create SVG element
            const svg = d3.select("#barchart-container")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Extract initial data for the starting year
            let currentData = data.filter(d => d.Year === currentYear);

            // Create scales
            const x = d3.scale.ordinal()
                .domain(currentData.map(function(d) { return d.Name; }))
                .rangeRoundBands([0, width], 0.1);


            const y = d3.scaleLinear()
                .domain([0, d3.max(currentData, d => d.Global_Sales)])
                .nice()
                .range([height, 0]);

            // Create initial bars
            const bars = svg.selectAll(".bar")
                .data(currentData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.Name))
                .attr("y", d => y(d.Global_Sales))
                .attr("width", x.rangeBand())
                .attr("height", d => height - y(d.Global_Sales));

            // Add labels to the bars
            bars.append("text")
                .attr("x", d => x(d.Name) + x.rangeBand() / 2)
                .attr("y", d => y(d.Global_Sales) - 5)
                .attr("text-anchor", "middle")
                .text(d => d.Global_Sales);

            // Function to update the chart for the next year
            function updateChart() {
                currentYear++; // Move to the next year
                currentData = data.filter(d => d.Year === currentYear); // Filter data for the current year

                // Update scales
                x.domain(currentData.map(d => d.Name));
                y.domain([0, d3.max(currentData, d => d.Global_Sales)]);

                // Update bars with transition
                bars.data(currentData)
                    .transition()
                    .duration(duration)
                    .attr("x", d => x(d.Name))
                    .attr("y", d => y(d.Global_Sales))
                    .attr("height", d => height - y(d.Global_Sales));

                // Update labels with transition
                svg.selectAll(".bar text")
                    .data(currentData)
                    .transition()
                    .duration(duration)
                    .attr("x", d => x(d.Name) + x.rangeBand() / 2)
                    .attr("y", d => y(d.Global_Sales) - 5)
                    .text(d => d.Global_Sales);
            }

            // Start the bar chart race
            setInterval(updateChart, duration + 100); // Repeat every duration + 100ms
        });
    </script>
</body>
</html>
